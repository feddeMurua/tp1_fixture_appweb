<html lang="es">
  <head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../estaticos/css/bootstrap.css"/>
    <title>App-Web 2018</title>
    <script type="text/javascript" src="../estaticos/js/jquery.js"></script>
    <script language="javascript">

      function calcular_puntos(dict,json,grupo, fecha, nro_partido) {

        $.each(json[grupo][fecha]["partidos"], function(i, f) {

          var goles_eq_1 = document.getElementById(f.equipo_1+nro_partido).value;
          var goles_eq_2 = document.getElementById(f.equipo_2+nro_partido).value;

          if (goles_eq_1 > goles_eq_2){
            var value = dict[f.equipo_1];
            dict[f.equipo_1] = value + 3;

          } else if (goles_eq_1 < goles_eq_2) {
              var value = dict[f.equipo_2];
              dict[f.equipo_2] = value + 3;

          } else {
              var value = dict[f.equipo_1];
              dict[f.equipo_1] = value + 1;
              var value = dict[f.equipo_2];
              dict[f.equipo_2] = value + 1;
          }

        });

      }

      function fase_octavos() {

        //Se carga el archivo
        json = JSON.parse(localStorage['json']);

        var dict = {};

        $.each(json["grupoA"]["equipos"], function(i, f) {
          dict[f.nombre] = 0;
        });

        calcular_puntos(dict, json, "grupoA", "fecha1", "_#partido_1_ga");
        calcular_puntos(dict, json, "grupoA", "fecha2", "_#partido_2_ga");
        calcular_puntos(dict, json, "grupoA", "fecha3", "_#partido_3_ga");

        console.log(dict);

      }

      function recorrer_grupo(json,grupo, fecha, nro_partido) {

        $.each(json[grupo][fecha]["partidos"], function(i, f) {

          var equipo_1 = "<label>" + f.equipo_1 + "</label>" ;
          var input_equipo_1 = "<input id='"+f.equipo_1+"_"+nro_partido+"' type='number' style='width:12%; text-align:center;'/>  "   ;
          var input_equipo_2 = "<input id='"+f.equipo_2+"_"+nro_partido+"' type='number' style='width:12%; text-align:center;'/>";
          var equipo_2 = "<label>" + f.equipo_2 + "</label> <br>" ;
          var estadio = "<label>" + f.estadio + "</label>";
          var ciudad = "<label>" + f.ciudad + "</label> ";
          var hora = "<label>" + f.hora + "</label> <br>";

          $(equipo_1).appendTo(nro_partido);
          $(nro_partido).append(" ");
          $(input_equipo_1).appendTo(nro_partido);
          $(nro_partido).append(" ");
          $(input_equipo_2).appendTo(nro_partido);
          $(nro_partido).append(" ");
          $(equipo_2).appendTo(nro_partido);
          $(nro_partido).append(" ");
          $(estadio).appendTo(nro_partido);
          $(nro_partido).append(" | ");
          $(ciudad).appendTo(nro_partido);
          $(nro_partido).append(" | ");
          $(hora).appendTo(nro_partido);

         });

      }

      //Muestro por consola el json recibido
      function datos(json) {

        // Se guarda el archivo para trabajarlo luego
        localStorage['json'] = JSON.stringify(json);

        recorrer_grupo(json, "grupoA", "fecha1", "#partido_1_ga");
        recorrer_grupo(json, "grupoA", "fecha2", "#partido_2_ga");
        recorrer_grupo(json, "grupoA", "fecha3", "#partido_3_ga");

        recorrer_grupo(json, "grupoB", "fecha1", "#partido_1_gb");
        recorrer_grupo(json, "grupoB", "fecha2", "#partido_2_gb");
        recorrer_grupo(json, "grupoB", "fecha3", "#partido_3_gb");

      }

      //fase de grupos
      function init() {
          $.getJSON(
            "server.php", // Server URL
            { fase: "grupos" }, // Dato que se envia al servidor
            datos
          );
      }

      // run AJAX query cuando carga la p√°gina.
      window.onload=init;

    </script>

  </head>

  <body>

    <h1 align="center">Fixture Mundial Rusia-2018</h1>

    <div class="row"  style="padding-left:2%;">

      <div class="col-sm-4">

        <div class="card">

          <div class="card-header">
            GRUPO A
          </div>

          <div class="card-body">

            <div class="card">
              <label id="fecha_1" style="text-align:center;">FECHA 1</label>
              <form method="get" style="text-align:center;">
                <label id="partido_1_ga"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_2" style="text-align:center;">FECHA 2</label>
              <form method="get" style="text-align:center;">
                <label id="partido_2_ga"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_3" style="text-align:center;">FECHA 3</label>
              <form method="get" style="text-align:center;">
                <label id="partido_3_ga"></label>
              </form>
            </div>

          </div>

        </div>

      </div>
      <!--
      <div class="col-sm-4">

        <div class="card">

          <div class="card-header">
            GRUPO B
          </div>

          <div class="card-body">

            <div class="card">
              <label id="fecha_1" style="text-align:center;">FECHA 1</label>
              <form method="get" style="text-align:center;">
                <label id="partido_1_gb"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_2" style="text-align:center;">FECHA 2</label>
              <form method="get" style="text-align:center;">
                <label id="partido_2_gb"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_3" style="text-align:center;">FECHA 3</label>
              <form method="get" style="text-align:center;">
                <label id="partido_3_gb"></label>
              </form>
            </div>

          </div>

        </div>

      </div>
      -->

    </div>


    <br>

    <div class="text-center">
      <button onclick="fase_octavos()" type="button" name="btn-octavos"> Cargar 8vos</button>
    </div>

  </body>
</html>
