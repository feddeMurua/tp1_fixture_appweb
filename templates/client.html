<html lang="es">
  <head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="../estaticos/css/bootstrap.css"/>
    <title>App-Web 2018</title>
    <script type="text/javascript" src="../estaticos/js/jquery.js"></script>
    <script language="javascript">

      function actualizar_tabla(goles_a_favor, goles_en_contra, equipo, dict_puntajes_grupo) {

        // trabajar sobre la tabla de puntaje
        dict_puntajes_grupo[equipo].goles_a_favor = dict_puntajes_grupo[equipo].goles_a_favor + parseInt(goles_a_favor);
        dict_puntajes_grupo[equipo].goles_en_contra = dict_puntajes_grupo[equipo].goles_en_contra + parseInt(goles_en_contra);
        dict_puntajes_grupo[equipo].dif_gol =  dict_puntajes_grupo[equipo].dif_gol + (parseInt(goles_a_favor) - parseInt(goles_en_contra));

        if ( goles_a_favor > goles_en_contra ) {
          dict_puntajes_grupo[equipo].puntos = dict_puntajes_grupo[equipo].puntos + 3;
        } else if (goles_a_favor == goles_en_contra) {
          dict_puntajes_grupo[equipo].puntos = dict_puntajes_grupo[equipo].puntos + 1;
        }

      }

      function calcular_puntos(json, grupo, fechas, nro_partidos, dict_puntajes_grupo){

          // 3 fechas por grupo.
          for (k = 0 ; k < 3 ; k++) {

            $.each(json[grupo][fechas[k]]["partidos"], function(i, f) {

              goles_eq_1 = document.getElementById(f.equipo_1+nro_partidos[k]).value;
              goles_eq_2 = document.getElementById(f.equipo_2+nro_partidos[k]).value;

              actualizar_tabla(goles_eq_1, goles_eq_2, f.equipo_1, dict_puntajes_grupo);
              actualizar_tabla(goles_eq_2, goles_eq_1, f.equipo_2, dict_puntajes_grupo);

            });

          }

      }

      //puntajes por cada equipo
      function crear_puntaje_equipo(nombre_equipo) {
        return {nombre:nombre_equipo,
                puntos:0,
                goles_a_favor:0,
                goles_en_contra:0,
                dif_gol:0
              };
      }

      function clasificacion_equipos() {

        //Se carga el archivo
        json = JSON.parse(localStorage['json']);

        //fechas
        var fechas = ["fecha1","fecha2","fecha3"];

        //tabla, datos cada equipo en el torneo
        dict_puntajes_grupoA = {} ; //por definicion, como no se declaro es GLOBAL.
        dict_puntajes_grupoB = {} ;
        dict_puntajes_grupoC = {} ;

        //Por cada equipo en el grupo se crea un objeto
        $.each(json["grupoA"]["equipos"], function(i, f) {

          var equipo = crear_puntaje_equipo(f.nombre);
          dict_puntajes_grupoA[f.nombre] = equipo;

        });

        $.each(json["grupoB"]["equipos"], function(i, f) {

          var equipo = crear_puntaje_equipo(f.nombre);
          dict_puntajes_grupoB[f.nombre] = equipo;

        });

        $.each(json["grupoC"]["equipos"], function(i, f) {

          var equipo = crear_puntaje_equipo(f.nombre);
          dict_puntajes_grupoC[f.nombre] = equipo;

        });

        calcular_puntos(json, "grupoA", fechas, ["_#partido_1_ga","_#partido_2_ga","_#partido_3_ga"], dict_puntajes_grupoA);
        calcular_puntos(json, "grupoB", fechas, ["_#partido_1_gb","_#partido_2_gb","_#partido_3_gb"], dict_puntajes_grupoB);
        calcular_puntos(json, "grupoC", fechas, ["_#partido_1_gc","_#partido_2_gc","_#partido_3_gc"], dict_puntajes_grupoC);

        console.log(dict_puntajes_grupoA);
        console.log(dict_puntajes_grupoB);
        console.log(dict_puntajes_grupoC);

      }

      function recorrer_grupo(json, grupo, fechas, nro_partidos) {

        // 3 fechas por grupo.
        for (k = 0 ; k < 3 ; k++) {

          $.each(json[grupo][fechas[k]]["partidos"], function(i, f) {

          var equipo_1 = "<label>" + f.equipo_1 + "</label>" ;
          var input_equipo_1 = "<input id='"+f.equipo_1+"_"+nro_partidos[k]+"' type='number' min='0' style='width:12%; text-align:center;'/>  "   ;
          var input_equipo_2 = "<input id='"+f.equipo_2+"_"+nro_partidos[k]+"' type='number' min='0' style='width:12%; text-align:center;'/>";
          var equipo_2 = "<label>" + f.equipo_2 + "</label> <br>" ;
          var estadio = "<label>" + f.estadio + "</label>";
          var ciudad = "<label>" + f.ciudad + "</label> ";
          var hora = "<label>" + f.hora + "</label> <br>";

          $(equipo_1).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" ");
          $(input_equipo_1).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" ");
          $(input_equipo_2).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" ");
          $(equipo_2).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" ");
          $(estadio).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" | ");
          $(ciudad).appendTo(nro_partidos[k]);
          $(nro_partidos[k]).append(" | ");
          $(hora).appendTo(nro_partidos[k]);

         });

       }

      }

      //Se almacena el json para trabajarlo luego en cada grupo
      function datos(json) {

        // Se guarda el archivo para trabajarlo luego
        localStorage['json'] = JSON.stringify(json);

        //fechas
        var fechas = ["fecha1","fecha2","fecha3"];

        recorrer_grupo(json, "grupoA", fechas, ["#partido_1_ga","#partido_2_ga","#partido_3_ga"]);
        recorrer_grupo(json, "grupoB", fechas, ["#partido_1_gb","#partido_2_gb","#partido_3_gb"]);
        recorrer_grupo(json, "grupoC", fechas, ["#partido_1_gc","#partido_2_gc","#partido_3_gc"]);

      }

      //fase de grupos
      function init() {
          $.getJSON(
            "../server.php", // Server URL
            { fase: "grupos" }, // Dato que se envia al servidor
            datos
          );
      }

      // run AJAX query cuando carga la p√°gina.
      window.onload=init;

    </script>

  </head>

  <body>

    <h1 align="center">Fixture Mundial Rusia-2018</h1>

    <div class="row"  style="padding-left:2%;">

      <div class="col-sm-4">

        <div class="card">

          <div class="card-header">
            GRUPO A
          </div>

          <div class="card-body">

            <div class="card">
              <label id="fecha_1" style="text-align:center;">FECHA 1</label>
              <form method="get" style="text-align:center;">
                <label id="partido_1_ga"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_2" style="text-align:center;">FECHA 2</label>
              <form method="get" style="text-align:center;">
                <label id="partido_2_ga"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_3" style="text-align:center;">FECHA 3</label>
              <form method="get" style="text-align:center;">
                <label id="partido_3_ga"></label>
              </form>
            </div>

          </div>

        </div>

      </div>

      <div class="col-sm-4">

        <div class="card">

          <div class="card-header">
            GRUPO B
          </div>

          <div class="card-body">

            <div class="card">
              <label id="fecha_1" style="text-align:center;">FECHA 1</label>
              <form method="get" style="text-align:center;">
                <label id="partido_1_gb"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_2" style="text-align:center;">FECHA 2</label>
              <form method="get" style="text-align:center;">
                <label id="partido_2_gb"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_3" style="text-align:center;">FECHA 3</label>
              <form method="get" style="text-align:center;">
                <label id="partido_3_gb"></label>
              </form>
            </div>

          </div>

        </div>

      </div>

      <div class="col-sm-4" style="padding-right:2%;">

        <div class="card">

          <div class="card-header">
            GRUPO C
          </div>

          <div class="card-body">

            <div class="card">
              <label id="fecha_1" style="text-align:center;">FECHA 1</label>
              <form method="get" style="text-align:center;">
                <label id="partido_1_gc"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_2" style="text-align:center;">FECHA 2</label>
              <form method="get" style="text-align:center;">
                <label id="partido_2_gc"></label>
              </form>
            </div>

            <br>

            <div class="card">
              <label id="fecha_3" style="text-align:center;">FECHA 3</label>
              <form method="get" style="text-align:center;">
                <label id="partido_3_gc"></label>
              </form>
            </div>

          </div>

        </div>

      </div>

    </div>

    <br>

    <div class="text-center">
      <button onclick="clasificacion_equipos()" type="button" name="btn-octavos"> Cargar 8vos</button>
    </div>

  </body>
</html>
